<!DOCTYPE html><html lang="fr-FR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Les design patterns - les bons Legos pour vos applications .NET" /><meta property="og:locale" content="fr_FR" /><meta name="description" content="Introduction : Ne réinventez pas la roue, assemblez les Legos" /><meta property="og:description" content="Introduction : Ne réinventez pas la roue, assemblez les Legos" /><link rel="canonical" href="https://codewithfrenchy.github.io//posts/utilisation-design-patterns/" /><meta property="og:url" content="https://codewithfrenchy.github.io//posts/utilisation-design-patterns/" /><meta property="og:site_name" content="CodeWithFrenchy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-09-22T10:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Les design patterns - les bons Legos pour vos applications .NET" /><meta name="twitter:site" content="@alexis35115" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-09-22T10:00:00-04:00","datePublished":"2025-09-22T10:00:00-04:00","description":"Introduction : Ne réinventez pas la roue, assemblez les Legos","headline":"Les design patterns - les bons Legos pour vos applications .NET","mainEntityOfPage":{"@type":"WebPage","@id":"https://codewithfrenchy.github.io//posts/utilisation-design-patterns/"},"url":"https://codewithfrenchy.github.io//posts/utilisation-design-patterns/"}</script><title>Les design patterns - les bons Legos pour vos applications .NET | CodeWithFrenchy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CodeWithFrenchy"><meta name="application-name" content="CodeWithFrenchy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/53872142?s=400&u=53187283fe05254234a3890e2b44134f96e3a833&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">CodeWithFrenchy</a></div><div class="site-subtitle font-italic">Architecte logiciel, audacieux et fermier</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>ACCUEIL</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATÉGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>À PROPOS DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/alexis35115" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexis35115" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/alexis-garon-michaud-a59643219/" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Accueil </a> </span> <span>Les design patterns - les bons Legos pour vos applications .NET</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Recherche..."> </span> <span id="search-cancel" >Annuler</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Les design patterns - les bons Legos pour vos applications .NET</h1><div class="post-meta text-muted"> <span> Posté <em class="" data-ts="1758549600" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 22/09/2025 </em> </span><div class="d-flex justify-content-between"> <span> Par <em> <a href="https://twitter.com/alexis35115">Alexis Garon-Michaud</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5563 mots"> <em>30 min</em> à lire</span></div></div></div><div class="post-content"><h2 id="introduction-ne-réinventez-pas-la-roue-assemblez-les-legos"><span class="mr-2">Introduction : Ne réinventez pas la roue, assemblez les Legos</span><a href="#introduction-ne-réinventez-pas-la-roue-assemblez-les-legos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En conception logicielle, un <strong>design pattern</strong> (ou patron de conception) est une solution éprouvée à un problème de conception récurrent. Ce sont en quelque sorte nos <strong>briques de Lego</strong> à nous, développeurs : plutôt que de tailler chaque pièce dans le bois, on pioche dans la boîte le composant adapté au bon moment. Bien comprendre ces patterns permet d’assembler des systèmes plus robustes et évolutifs, un peu comme construire un château de Lego solide sans recoller les briques au chewing-gum. 😉</p><p>En d’autres termes, les design patterns nous évitent de <strong>réinventer la roue</strong> sur chaque projet. Ils définissent des structures de classes ou d’objets qui ont fait leurs preuves. Par exemple, <em>le Singleton s’assure de l’existence d’un seul objet de son genre et fournit un point d’accès global à celui-ci</em>. Utiliser un pattern approprié au bon contexte, c’est comme choisir la bonne pièce Lego standard plutôt que de mouler la vôtre. Cela accélère le développement et améliore la maintenabilité, tout en respectant les principes <a href="https://en.wikipedia.org/wiki/SOLID">SOLID</a>.</p><p>Avant de plonger dans sept patterns importants pour les applications de gestion en .NET Core, mentionnons une excellente ressource : la <a href="https://www.youtube.com/watch?v=v9ejT8FO-7I&amp;list=PLrhzvIcii6GNjpARdnO4ueTUAVR9eMBpc">série</a> de vidéos de <strong>Christopher Okhravi</strong> sur les design patterns (disponible sur YouTube). Elle reste encore aujourd’hui une référence pédagogique (et humoristique) sur le sujet. Vous verrez qu’avec un peu de pratique, les design patterns deviendront vos alliés du quotidien pour structurer proprement un code métier (facturation, inventaire, etc.) sans transformer votre code en plat de spaghetti. 🍝</p><p>Nous allons explorer les patterns suivants, avec pour chacun une explication, un exemple concret, un extrait de code C#, les cas d’usage à favoriser (et à éviter), ainsi que des astuces d’intégration en .NET (notamment via l’IoC container et autres outils comme <strong>Scrutor</strong> pour le pattern Decorator).</p><p>En piste !</p><h2 id="singleton-un-seul-pour-les-gouverner-tous-un-seul-pour-les-instancier"><span class="mr-2">Singleton : Un seul pour les gouverner tous, un seul pour les instancier,</span><a href="#singleton-un-seul-pour-les-gouverner-tous-un-seul-pour-les-instancier" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Le pattern Singleton garantit qu’une classe n’a qu’une seule instance accessible globalement.</em></p><p>Le Singleton est le Highlander des patterns : <em>« There can be only one! »</em> 😅 Son objectif est de restreindre l’instanciation d’une classe à un seul objet, partagé et accessible partout. Dans une application de gestion, on utilise souvent ce pattern pour des objets qui doivent être uniques : par exemple un <strong>gestionnaire de configuration global</strong>, une <strong>cache en mémoire</strong> ou encore un <strong>logger</strong> central. Cela évite d’avoir plusieurs copies incohérentes de ces ressources critiques disséminées un peu partout.</p><h3 id="exemple-concret"><span class="mr-2">Exemple concret</span><a href="#exemple-concret" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Imaginons un système de facturation qui doit accéder aux paramètres de configuration (taux de TVQ, devise, etc.) depuis n’importe quel module. On pourrait créer une classe <code class="language-plaintext highlighter-rouge">ConfigurationManager</code> en Singleton. Ainsi, que ce soit le module de génération de facture ou le module d’inventaire, tous récupèrent la même instance unique du <code class="language-plaintext highlighter-rouge">ConfigurationManager</code> avec les paramètres chargés au lancement de l’application.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">ConfigurationManager</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">ConfigurationManager</span> <span class="n">_instance</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">ConfigurationManager</span> <span class="n">Instance</span> <span class="p">=&gt;</span> <span class="n">_instance</span><span class="p">;</span>

    <span class="c1">// Données de configuration (exemple)</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">TauxTVQ</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">DeviseParDefaut</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">// Constructeur privé pour empêcher les instanciations externes</span>
    <span class="k">private</span> <span class="nf">ConfigurationManager</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Simulation de chargement depuis une source de vérité (fichier, base, ou grimoire fiscal)</span>
        <span class="n">TauxTVQ</span> <span class="p">=</span> <span class="m">0.09975m</span><span class="p">;</span> <span class="c1">// TVQ actuelle au Québec</span>
        <span class="n">DeviseParDefaut</span> <span class="p">=</span> <span class="s">"CAD"</span><span class="p">;</span> <span class="c1">// Vive le dollar canadien!</span>
    <span class="p">}</span>

    <span class="c1">// Méthode d'accès optionnelle</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">ConfigurationManager</span> <span class="nf">GetInstance</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Instance</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Dans le code ci-dessus, <code class="language-plaintext highlighter-rouge">ConfigurationManager.Instance</code> renverra toujours la même instance, initialisée une seule fois. On déclare le constructeur en <code class="language-plaintext highlighter-rouge">private</code> pour empêcher de faire <code class="language-plaintext highlighter-rouge">new ConfigurationManager()</code>. Seule la propriété statique <code class="language-plaintext highlighter-rouge">Instance</code> permet d’obtenir l’objet unique.</p><p><strong>Quand l’utiliser 🟢 :</strong> Lorsqu’une seule instance d’un service doit exister et être partagée partout. Exemples classiques : configuration globale, journalisation (logging), connexion unique à une base de données, cache applicatif. Cela permet de centraliser un état ou un accès et d’éviter les duplications.</p><p><strong>À éviter 🔴 :</strong> N’abusez pas du Singleton ! Un Singleton mal placé peut devenir un <em>god object</em> omniprésent qui rend le code difficile à tester (dépendances globales cachées) et moins modulable. Si plusieurs instances seraient acceptables ou que l’objet a un cycle de vie limité, préférez des instances normales gérées par injection de dépendances. En .NET, beaucoup considèrent d’ailleurs le Singleton comme un <em>antipattern</em> si utilisé à tort et à travers.</p><p><strong>Intégration .NET 👩‍💻 :</strong> Plutôt que d’implémenter le Singleton “à la main” comme ci-dessus, on profite souvent du conteneur d’inversion de contrôle (IoC) de .NET. En enregistrant une classe en <em>singleton</em> dans le container, le framework garantit lui-même l’unicité de l’instance. Par exemple, dans le <code class="language-plaintext highlighter-rouge">Program.cs</code> :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IConfigurationManager</span><span class="p">,</span> <span class="n">ConfigurationManager</span><span class="p">&gt;();</span>
</pre></table></code></div></div><p>Ici le container va créer une seule instance de <code class="language-plaintext highlighter-rouge">ConfigurationManager</code> pour toute l’application. C’est thread-safe et plus simple à tester (on peut éventuellement substituer l’implémentation via l’interface). <strong>Astuce:</strong> Si votre Singleton est lourd à instancier et pas toujours utilisé, envisagez le pattern du Lazy Singleton (instanciation différée).</p><h2 id="factory-fabrique-dobjets-évitez-le-new"><span class="mr-2">Factory : Fabrique d’objets, évitez le <strong>new</strong></span><a href="#factory-fabrique-dobjets-évitez-le-new" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Le pattern Factory (ici la Factory Method) crée des objets selon le type demandé sans exposer la logique de création.</em></p><p>Le pattern <strong>Factory</strong> est un patron de création qui repose sur le principe suivant : <em>« Ne dites pas <code class="language-plaintext highlighter-rouge">new</code>, dites <code class="language-plaintext highlighter-rouge">Factory</code>! »</em>. Plutôt que d’instancier directement des classes dans votre code (ce qui le couplerait à des implémentations concrètes), vous déléguez cette tâche à une <strong>fabrique</strong>. La Factory centralise la logique de création et peut décider quel sous-type concret retourner en fonction du contexte. C’est un peu comme une usine qui, sur base d’une commande, sort le bon produit de la chaîne sans que l’acheteur ne sache exactement comment il a été fabriqué.</p><h3 id="exemple-concret-1"><span class="mr-2">Exemple concret</span><a href="#exemple-concret-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Dans un système de gestion documentaire (factures, bons de commande, devis, etc.), on peut avoir une interface commune <code class="language-plaintext highlighter-rouge">IDocument</code> et plusieurs implémentations (<code class="language-plaintext highlighter-rouge">Facture</code>, <code class="language-plaintext highlighter-rouge">Devis</code>, <code class="language-plaintext highlighter-rouge">BonCommande</code>…). Au lieu d’éparpiller du code <code class="language-plaintext highlighter-rouge">new Facture()</code> partout, on définit une factory qui va produire le bon type de document selon un paramètre. Par exemple, une méthode <code class="language-plaintext highlighter-rouge">DocumentFactory.CreateDocument(TypeDocument type)</code> qui retourne un <code class="language-plaintext highlighter-rouge">IDocument</code> :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c1">// Type énuméré pour les différents documents possibles</span>
<span class="k">public</span> <span class="k">enum</span> <span class="n">TypeDocument</span>
<span class="p">{</span> 
   <span class="n">Facture</span><span class="p">,</span>
   <span class="n">Devis</span><span class="p">,</span>
   <span class="n">BonCommande</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="nc">IDocument</span> 
<span class="p">{</span> 
    <span class="kt">string</span> <span class="n">Numero</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">DateTime</span> <span class="n">DateEmission</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">// ... autres membres communs</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Facture</span> <span class="p">:</span> <span class="n">IDocument</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Devis</span> <span class="p">:</span> <span class="n">IDocument</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">BonCommande</span> <span class="p">:</span> <span class="n">IDocument</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">DocumentFactory</span> 
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IDocument</span> <span class="nf">CreateDocument</span><span class="p">(</span><span class="n">TypeDocument</span> <span class="n">type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">type</span> <span class="k">switch</span> 
        <span class="p">{</span>
            <span class="n">TypeDocument</span><span class="p">.</span><span class="n">Facture</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Facture</span><span class="p">(),</span>
            <span class="n">TypeDocument</span><span class="p">.</span><span class="n">Devis</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Devis</span><span class="p">(),</span>
            <span class="n">TypeDocument</span><span class="p">.</span><span class="n">BonCommande</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">BonCommande</span><span class="p">(),</span>
            <span class="n">_</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Type de document inconnu"</span><span class="p">)</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ici, le <code class="language-plaintext highlighter-rouge">DocumentFactory</code> expose une méthode statique de création. Le client appelle par exemple <code class="language-plaintext highlighter-rouge">IDocument doc = DocumentFactory.CreateDocument(TypeDocument.Facture);</code> pour obtenir une facture prête à l’emploi, sans savoir <em>quelle classe concrète</em> est instanciée. Si demain on ajoute un nouveau type de document (par exemple un avoir), il suffit d’étendre la factory sans impacter le code client.</p><p><strong>Quand l’utiliser 🟢 :</strong> Quand la logique d’instanciation est <em>complexe</em> ou <em>conditionnelle</em>. Par exemple, si la création d’un objet dépend de paramètres (contexte utilisateur, configuration) ou nécessite de décider parmi plusieurs types dérivés. Les Factories améliorent la lisibilité (on donne un nom explicite au processus de création) et centralisent en un seul endroit le code qui fait des <code class="language-plaintext highlighter-rouge">new</code>. Très utile pour :</p><ul><li><strong>Factory Method</strong> : laisser des sous-classes décider de l’instanciation (patron utilisé dans les frameworks, par exemple pour créer des contrôles UI spécifiques).<li><strong>Abstract Factory</strong> : groupe de factories pour créer des familles d’objets liés (exemple une AbstractFactory pour GUI qui peut produire <em>soit</em> des boutons et fenêtres version “Windows”, <em>soit</em> version “macOS”).</ul><p><strong>À éviter 🔴 :</strong> Si la création de l’objet est triviale et ne nécessite pas de logique conditionnelle, une factory ajoute une complexité inutile. Inutile de sur-ingénierie : on ne va pas faire une factory pour instancier un simple DTO par exemple. De plus, trop de factories peuvent rendre le code abstrait à l’excès (on finit par avoir des usines qui fabriquent d’autres usines…). Comme toujours, dosez le pattern où il apporte une réelle valeur.</p><p><strong>Intégration .NET 👩‍💻 :</strong> Les IoC containers réduisent parfois le besoin explicite de factory, car ils peuvent eux-mêmes choisir quelle implémentation injecter selon la configuration. Par exemple, on peut enregistrer plusieurs implémentations d’une interface et en sélectionner une par nom ou via une factory lambda dans le container. Néanmoins, le pattern Factory reste utile pour créer des objets <strong>métiers</strong> complexes.</p><p>En .NET Core, vous pouvez aussi injecter une <em>factory</em> sous forme de fonction. Ex: <code class="language-plaintext highlighter-rouge">Func&lt;TypeDocument, IDocument&gt;</code> que l’IoC pourrait construire. Une autre approche est d’utiliser la factory en tant que service : vous créez une classe <code class="language-plaintext highlighter-rouge">DocumentFactory</code> (non statique) enregistrée en singleton, et qui a peut-être besoin d’autres services (elle peut les recevoir via injection dans son constructeur) pour fabriquer les objets. Cette technique vous permet par exemple de choisir l’implémentation en fonction de données à l’exécution (on le verra avec le patron Strategy juste après).</p><h2 id="strategy-des-algorithmes-interchangeables-choisis-à-la-volée"><span class="mr-2">Strategy : des algorithmes interchangeables, choisis à la volée</span><a href="#strategy-des-algorithmes-interchangeables-choisis-à-la-volée" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Le pattern Strategy définit des algorithmes interchangeables. Le contexte délègue à une stratégie concrète (<code class="language-plaintext highlighter-rouge">ConcreteStrategyA ou ConcreteStrategyB</code>) choisie dynamiquement.</em></p><p>Le pattern <strong>Strategy</strong> permet de définir une famille d’algorithmes, de les encapsuler chacun dans une classe distincte, et de les rendre <strong>interchangeables à la volée</strong> dans le contexte où ils sont utilisés. En clair, on sépare le <em>quoi</em> (l’algorithme à exécuter) du <em>quand/comment</em> il est utilisé.</p><p>L’un des grands bénéfices de ce pattern est qu’il <strong>respecte le principe d’ouverture/fermeture</strong> (<em>Open/Closed Principle</em>) : votre code est <strong>ouvert à l’extension</strong>, mais <strong>fermé à la modification</strong>. Autrement dit, si un jour un nouveau mode de calcul doit être ajouté (par exemple une livraison par drone 🛸), pas besoin de toucher au calculateur existant : on ajoute une nouvelle stratégie, et c’est tout.</p><p>C’est une alternative élégante et maintenable aux chaînes de <code class="language-plaintext highlighter-rouge">if/else</code> ou de <code class="language-plaintext highlighter-rouge">switch</code> sur des <code class="language-plaintext highlighter-rouge">enums</code>, qui violent souvent ce principe (car chaque ajout nécessite de modifier le bloc conditionnel existant). Avec le patron Strategy, on <strong>étend</strong> le comportement en ajoutant une nouvelle classe, plutôt qu’en modifiant du code existant — ce qui réduit les risques de régression.</p><h3 id="exemple-concret-2"><span class="mr-2">Exemple concret</span><a href="#exemple-concret-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Dans une application de gestion de commerce en ligne, prenons le calcul des <strong>frais de livraison</strong>. Selon le mode d’expédition choisi par le client, le calcul du coût diffère (transporteur standard, express, retrait en magasin gratuit, etc.). Sans pattern, on aurait peut-être dans la classe Commande un code semblable à :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kt">decimal</span> <span class="n">frais</span> <span class="p">=</span> <span class="n">mode</span> <span class="k">switch</span>
<span class="p">{</span>
    <span class="s">"Standard"</span> <span class="p">=&gt;</span> <span class="nf">CalculerStandard</span><span class="p">(),</span>
    <span class="s">"Express"</span> <span class="p">=&gt;</span> <span class="nf">CalculerExpress</span><span class="p">(),</span>
    <span class="s">"Magasin"</span> <span class="p">=&gt;</span> <span class="m">0</span><span class="p">,</span>
    <span class="n">_</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">()</span>
<span class="p">};</span>
<span class="p">...</span>
</pre></table></code></div></div><p>Avec le patron Strategy, on va créer une interface <code class="language-plaintext highlighter-rouge">IFraisLivraisonStrategy</code> avec une méthode <code class="language-plaintext highlighter-rouge">CalculerFrais(Commande commande)</code>. Puis on implémente une classe concrète par mode : <code class="language-plaintext highlighter-rouge">StandardStrategy</code>, <code class="language-plaintext highlighter-rouge">ExpressStrategy</code>, <code class="language-plaintext highlighter-rouge">RetraitMagasinStrategy</code>, etc., chacune encapsulant son calcul. Le contexte (par exemple la classe <code class="language-plaintext highlighter-rouge">CalculateurLivraison</code>) utilise une référence à <code class="language-plaintext highlighter-rouge">IFraisLivraisonStrategy</code>.</p><p>On peut pousser plus loin en combinant avec une Factory Method pour choisir la stratégie en fonction de la commande :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">// Stratégie de calcul des frais de livraison</span>
<span class="k">public</span> <span class="k">interface</span> <span class="nc">IFraisLivraisonStrategy</span> 
<span class="p">{</span>
    <span class="kt">decimal</span> <span class="nf">CalculerFrais</span><span class="p">(</span><span class="n">Commande</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Implémentations concrètes</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">LivraisonStandard</span> <span class="p">:</span> <span class="n">IFraisLivraisonStrategy</span> 
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="nf">CalculerFrais</span><span class="p">(</span><span class="n">Commande</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="m">5m</span><span class="p">;</span> <span class="c1">// Forfait simple</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">LivraisonExpress</span> <span class="p">:</span> <span class="n">IFraisLivraisonStrategy</span> 
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="nf">CalculerFrais</span><span class="p">(</span><span class="n">Commande</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">cmd</span><span class="p">.</span><span class="n">Poids</span> <span class="p">*</span> <span class="m">1.5m</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">RetraitMagasin</span> <span class="p">:</span> <span class="n">IFraisLivraisonStrategy</span> 
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="nf">CalculerFrais</span><span class="p">(</span><span class="n">Commande</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="m">0m</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Contexte qui utilise une stratégie</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CalculateurLivraison</span> 
<span class="p">{</span>
    <span class="k">private</span> <span class="n">IFraisLivraisonStrategy</span> <span class="n">_strategie</span><span class="p">;</span>

    <span class="c1">// On devrait injecter la stratégie via le constructeur !</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ChoisirStrategie</span><span class="p">(</span><span class="n">IFraisLivraisonStrategy</span> <span class="n">strat</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">_strategie</span> <span class="p">=</span> <span class="n">strat</span><span class="p">;</span>

    <span class="k">public</span> <span class="kt">decimal</span> <span class="nf">CalculerFrais</span><span class="p">(</span><span class="n">Commande</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">=&gt;</span> 
        <span class="k">return</span> <span class="n">_strategie</span><span class="p">?.</span><span class="nf">CalculerFrais</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="p">??</span>
           <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Stratégie non définie."</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Et quelque part dans le code appelant (par exemple lors de la finalisation de la commande) :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">calculateur</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CalculateurLivraison</span><span class="p">();</span>

<span class="n">IFraisLivraisonStrategy</span> <span class="n">strategie</span> <span class="p">=</span> <span class="n">modeChoisi</span> <span class="k">switch</span> 
<span class="p">{</span>
    <span class="s">"Standard"</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">LivraisonStandard</span><span class="p">(),</span>
    <span class="s">"Express"</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">LivraisonExpress</span><span class="p">(),</span>
    <span class="s">"Magasin"</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">RetraitMagasin</span><span class="p">(),</span>
    <span class="n">_</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Mode inconnu"</span><span class="p">)</span>
<span class="p">};</span>

<span class="n">calculateur</span><span class="p">.</span><span class="nf">ChoisirStrategie</span><span class="p">(</span><span class="n">strategie</span><span class="p">);</span>
<span class="kt">decimal</span> <span class="n">frais</span> <span class="p">=</span> <span class="n">calculateur</span><span class="p">.</span><span class="nf">CalculerFrais</span><span class="p">(</span><span class="n">commande</span><span class="p">);</span>
</pre></table></code></div></div><p>Ici, on choisit la stratégie dynamiquement en fonction d’un paramètre <code class="language-plaintext highlighter-rouge">modeChoisi</code>. Le calculateur de livraison n’a pas besoin de connaître les détails de chaque mode, il délègue à la stratégie. Si un jour on ajoute un mode Drone ou à dos de vache 🐮, on crée une nouvelle classe implémentant <code class="language-plaintext highlighter-rouge">IFraisLivraisonStrategy</code> et on ajuste la sélection (idéalement via une factory au lieu d’un switch inline).</p><p><strong>Quand l’utiliser 🟢 :</strong> Quand vous avez plusieurs variantes algorithmiques interchangeables selon un critère (par exemple, différents <em>règles de calcul</em>, <em>politiques</em>, <em>stratégies de tarification</em>, etc.). Le Strategy apporte de la flexibilité : on peut même changer la stratégie en cours d’exécution si besoin. C’est aussi un bon moyen d’adhérer au principe <em>Open/Closed</em> – ajouter une nouvelle stratégie n’impacte pas les existantes ni le contexte.</p><p><strong>À éviter 🔴 :</strong> Si vos variantes d’algorithmes sont très simples ou qu’il n’y en a qu’une ou deux peu susceptibles d’évoluer, le pattern peut être overkill. Aussi, n’introduisez pas une stratégie juste pour éviter un <code class="language-plaintext highlighter-rouge">if</code> unique — le remède serait pire que le mal. Enfin, veillez à ce que les stratégies partagent bien la même interface commune et puissent réellement varier indépendamment du reste : si elles finissent par dépendre fortement du contexte externe, le gain de découplage diminue.</p><p><strong>Intégration .NET 👩‍💻 :</strong> On peut tirer parti de l’IoC container pour gérer les stratégies. Par exemple, vous pourriez <strong>injecter toutes les implémentations</strong> d’une interface et sélectionner la bonne à l’exécution (via un dictionnaire de stratégies, ou en taguant chaque implémentation d’un <code class="language-plaintext highlighter-rouge">attribut</code> \ <code class="language-plaintext highlighter-rouge">[Strategy("Nom")])</code>. Une autre approche consiste à enregistrer une Factory (comme vue plus haut) dans l’IoC qui retourne la stratégie voulue. .NET Core facilite même cela avec les <em>Named Options</em> ou en combinant avec le pattern <strong>Policy</strong>. Bref, le patron Strategy se marie bien avec l’injection de dépendances pour éviter de faire de <code class="language-plaintext highlighter-rouge">new</code> manuellement : on peut demander au container de résoudre la stratégie dont on a besoin, ce qui simplifie le remplacement (ex: injection d’une fausse stratégie en tests unitaires).</p><h2 id="decorator-ajouter-des-fonctionnalités-à-la-volée-comme-une-cache-sur-vos-services"><span class="mr-2">Decorator : Ajouter des fonctionnalités à la volée (comme une cache sur vos services)</span><a href="#decorator-ajouter-des-fonctionnalités-à-la-volée-comme-une-cache-sur-vos-services" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Le pattern Decorator ajoute dynamiquement des comportements à un objet en l’enveloppant dans un “décorateur” qui implémente la même interface.</em></p><p>Le pattern <strong>Decorator</strong> (ou <strong>Wrapper</strong>) est un patron structurel qui permet d’<strong>ajouter dynamiquement des responsabilités</strong> à un objet, sans modifier son code source. Imaginez un cadeau qu’on emballe et re-emballe : le contenu reste le même, mais chaque couche de papier ajoute une fonctionnalité (un message, un ruban, etc.). En informatique, un décorateur est un objet qui <em>implémente la même interface</em> que l’objet qu’il décore, et qui contient une référence vers lui-même. Il peut ainsi intercepter les appels, faire quelque chose en plus, puis déléguer à l’objet réel.</p><h3 id="exemple-concret-3"><span class="mr-2">Exemple concret</span><a href="#exemple-concret-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Considérons un microservice d’inventaire qui expose un service <code class="language-plaintext highlighter-rouge">IProduitService</code> avec une méthode <code class="language-plaintext highlighter-rouge">ObtenirProduit(int id)</code> retournant les détails d’un produit. Les appels à ce service peuvent être coûteux (imaginons qu’il interroge une base de données distante). On souhaite <strong>mettre en cache</strong> les résultats pour améliorer les performances. Sans changer le code du service existant, on peut créer un décorateur de cache.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">interface</span> <span class="nc">IProduitService</span>
<span class="p">{</span>
    <span class="n">ValueTask</span><span class="p">&lt;</span><span class="n">Produit</span><span class="p">&gt;</span> <span class="nf">ObtenirProduit</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Implémentation principale (accès base de données par exemple)</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ProduitService</span> <span class="p">:</span> <span class="n">IProduitService</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">ValueTask</span><span class="p">&lt;</span><span class="n">Produit</span><span class="p">&gt;</span> <span class="nf">ObtenirProduit</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Accès BDD pour le produit </span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">50</span><span class="p">);</span> <span class="c1">// Simule un accès I/O</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Produit</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="n">id</span><span class="p">,</span> <span class="n">Nom</span> <span class="p">=</span> <span class="s">$"Produit </span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="s">"</span> <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Decorator de cache</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ProduitServiceCacheDecorator</span> <span class="p">:</span> <span class="n">IProduitService</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IProduitService</span> <span class="n">_produitService</span><span class="p">;</span>
    <span class="c1">// Devrait provenir de l'IoC</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">MemoryCache</span> <span class="n">_cache</span> <span class="p">=</span> <span class="k">new</span><span class="p">(</span><span class="k">new</span> <span class="nf">MemoryCacheOptions</span><span class="p">());</span>

    <span class="k">public</span> <span class="nf">ProduitServiceCacheDecorator</span><span class="p">(</span><span class="n">IProduitService</span> <span class="n">produitService</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_produitService</span> <span class="p">=</span> <span class="n">produitService</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">ValueTask</span><span class="p">&lt;</span><span class="n">Produit</span><span class="p">&gt;</span> <span class="nf">ObtenirProduit</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_cache</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">out</span> <span class="n">Produit</span> <span class="n">produit</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Cache hit pour le produit </span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">ValueTask</span><span class="p">&lt;</span><span class="n">Produit</span><span class="p">&gt;(</span><span class="n">produit</span><span class="p">);</span> <span class="c1">// disponible de manière synchrone</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nf">ObtenirEtCacher</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">async</span> <span class="n">ValueTask</span><span class="p">&lt;</span><span class="n">Produit</span><span class="p">&gt;</span> <span class="nf">ObtenirEtCacher</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">resultat</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_produitService</span><span class="p">.</span><span class="nf">GetProduit</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="n">_cache</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">resultat</span><span class="p">,</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">5</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">resultat</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>💡 <strong>Pourquoi <code class="language-plaintext highlighter-rouge">ValueTask</code> ici ?</strong> Parce que dans le cas où la cache répond, il est inutile de créer une <code class="language-plaintext highlighter-rouge">Task</code>, <code class="language-plaintext highlighter-rouge">ValueTask</code> permet de <strong>réduire la pression sur le GC</strong> pour les cas de réponse rapide. Mais attention : si le service sous-jacent est très souvent asynchrone, <code class="language-plaintext highlighter-rouge">Task&lt;T&gt;</code> reste le bon choix !</p></blockquote><p>Ici, <code class="language-plaintext highlighter-rouge">ProduitServiceCacheDecorator</code> <strong>décore</strong> un <code class="language-plaintext highlighter-rouge">IProduitService</code> concret (_produitService). Il ajoute la fonctionnalité de caching autour de l’appel réel. Pour le consommateur, c’est transparent : il utilise un <code class="language-plaintext highlighter-rouge">IProduitService</code> sans savoir si c’est le cache ou le service de base. On peut composer plusieurs décorateurs les uns avec les autres si besoin (log, sécurité, etc.), chaque décorateur enveloppant le précédent.</p><p><strong>Quand l’utiliser 🟢 :</strong> Quand vous voulez <strong>enrichir</strong> ou <strong>modifier dynamiquement</strong> le comportement d’un objet <em>sans</em> altérer son code. C’est idéal pour les <strong>fonctionnalités transversales</strong> (caching, logging, contrôle d’accès, mesure de performance…). Le Decorator est plus souple que l’héritage car on peut empiler plusieurs décorateurs et en activer/désactiver certains à la configuration.</p><p><strong>À éviter 🔴 :</strong> Si la hiérarchie de décorateurs devient trop complexe ou que vous en avez un très grand nombre, ça peut devenir difficile à suivre en debug (effet <em>oignon</em>, on se perd dans les couches). Si l’objet de base a déjà une bonne extension via des mécanismes plus simples, inutile de rajouter en plus des décorateurs. Enfin, n’utilisez pas un décorateur juste pour factoriser du code commun entre deux classes : dans ce cas, une abstraction ou un <a href="https://en.wikipedia.org/wiki/Mixin">mixin</a> serait plus approprié.</p><p><strong>Intégration .NET 👩‍💻 :</strong> .NET Core facilite la vie avec l’IoC container pour chaîner les décorateurs sans douleur, grâce à des librairies comme <strong>Scrutor</strong>. Scrutor fournit une méthode d’extension <code class="language-plaintext highlighter-rouge">Decorate&lt;,&gt;()</code> qui enregistre un décorateur pour un service existant. Par exemple, pour notre cas ci-dessus :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IProduitService</span><span class="p">,</span> <span class="n">ProduitService</span><span class="p">&gt;();</span>
<span class="n">services</span><span class="p">.</span><span class="n">Decorate</span><span class="p">&lt;</span><span class="n">IProduitService</span><span class="p">,</span> <span class="n">ProduitServiceCacheDecorator</span><span class="p">&gt;();</span>
</pre></table></code></div></div><p>Comme le décrit Andrew Lock, <em>“Scrutor cherche tout service enregistré en <code class="language-plaintext highlighter-rouge">IProduitService</code> (ici <code class="language-plaintext highlighter-rouge">ProduitService</code>) et le remplace par <code class="language-plaintext highlighter-rouge">ProduitServiceCacheDecorator</code> qui prendra en paramètre de constructeur l’ancien service”</em>. En un appel, on a intercalé le cache entre l’application et le service réel. Scrutor gère l’ordre (il faut ajouter le décorateur <strong>après</strong> le service de base) et la résolution des dépendances supplémentaires du décorateur.</p><p>Sans Scrutor, on peut toujours enregistrer manuellement un décorateur : par exemple, on enregistre <code class="language-plaintext highlighter-rouge">ProduitService</code> puis on enregistre <code class="language-plaintext highlighter-rouge">IProduitService</code> pointant vers un <code class="language-plaintext highlighter-rouge">provider =&gt; new ProduitServiceCacheDecorator(new ProduitService(...))</code>. Mais avouons que Scrutor fait ça proprement, de façon déclarative.</p><h2 id="middleware-le-pipeline-http-dans-aspnet-core"><span class="mr-2">Middleware : le pipeline HTTP dans ASP.NET Core</span><a href="#middleware-le-pipeline-http-dans-aspnet-core" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Pipeline de middlewares ASP.NET Core : chaque middleware (1, 2, 3) traite la requête puis appelle le suivant, formant une chaîne autour de la requête/réponse.</em></p><p>Le terme <strong>Middleware</strong> désigne un composant logiciel intermédiaire qui s’insère dans une chaîne de traitement. En ASP.NET Core, <em>le pipeline de requête HTTP est une illustration concrète du pattern Chain of Responsibility</em> appliqué aux requêtes et réponses HTTP. Chaque middleware a la possibilité d’agir sur la requête entrante, de décider de la court-circuiter (renvoyer directement une réponse) ou de faire quelque chose avant/après de passer la main au middleware suivant.</p><p>En fait, un middleware ASP.NET Core est une implémentation spécialisée du pattern Decorator/Chain, dédiée aux requêtes HTTP. Vous en utilisez à chaque fois que vous faites <code class="language-plaintext highlighter-rouge">app.UseXyz(...)</code> dans le <code class="language-plaintext highlighter-rouge">Program.cs</code> : authentification, logging, routing, etc., sont des middlewares standards.</p><h3 id="exemple-concret-4"><span class="mr-2">Exemple concret</span><a href="#exemple-concret-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Supposons que l’on veuille journaliser le temps de traitement de certaines requêtes pour une API de gestion d’inventaire. On peut écrire un middleware custom <code class="language-plaintext highlighter-rouge">LoggingMiddleware</code> qui, pour chaque requête, enregistre l’heure de début, appelle le composant suivant, puis enregistre l’heure de fin et calcule la durée.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">LoggingMiddleware</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">RequestDelegate</span> <span class="n">_next</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">TimeProvider</span> <span class="n">_timeProvider</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">LoggingMiddleware</span><span class="p">(</span><span class="n">RequestDelegate</span> <span class="n">next</span><span class="p">,</span>
       <span class="n">TimeProvider</span> <span class="n">timeProvider</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_next</span> <span class="p">=</span> <span class="n">next</span><span class="p">;</span>
        <span class="n">_timeProvider</span> <span class="p">=</span> <span class="n">timeProvider</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Invoke</span><span class="p">(</span><span class="n">HttpContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">debut</span> <span class="p">=</span> <span class="n">_timeProvider</span><span class="p">.</span><span class="nf">GetUtcNow</span><span class="p">();</span>
        <span class="k">await</span> <span class="nf">_next</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">duration</span> <span class="p">=</span> <span class="n">_timeProvider</span><span class="p">.</span><span class="nf">GetUtcNow</span><span class="p">()</span> <span class="p">-</span> <span class="n">debut</span><span class="p">;</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Requête </span><span class="p">{</span><span class="n">context</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Path</span><span class="p">}</span><span class="s"> traitée en </span><span class="p">{</span><span class="n">duration</span><span class="p">.</span><span class="n">TotalMilliseconds</span><span class="p">}</span><span class="s"> ms"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Dans le <code class="language-plaintext highlighter-rouge">Program.cs</code>, on l’enregistre dans le pipeline :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="n">UseMiddleware</span><span class="p">&lt;</span><span class="n">LoggingMiddleware</span><span class="p">&gt;();</span>
</pre></table></code></div></div><p>Chaque requête HTTP va passer par ce middleware, puis continuer. On pourrait chaîner d’autres middlewares avant/après. Par exemple, on pourrait ajouter un middleware de cache en amont qui vérifie si la réponse n’est pas déjà en cache (et ne pas appeler <code class="language-plaintext highlighter-rouge">_next</code> du tout s’il trouve quelque chose), ou un middleware d’authentification qui vérifie le token JWT puis appelle <code class="language-plaintext highlighter-rouge">_next</code> si OK, ou renvoie 401 immédiatement si non autorisé.</p><p><strong>Quand l’utiliser 🟢 :</strong> Les middlewares sont <em>incontournables</em> en développement ASP.NET Core pour tout ce qui est <strong>cross-cutting</strong> au niveau des requêtes HTTP. C’est littéralement la façon de faire officielle pour filtrer/travailler sur les requêtes et réponses. Dans un contexte plus large, on peut assimiler n’importe quelle suite de traitements séquentiels modulaires à ce concept de middleware. Donc utilisez ce pattern/pipeline dès que vous avez un traitement en plusieurs étapes où chaque étape peut décider de stopper ou de modifier le flux.</p><p><strong>À éviter 🔴 :</strong> En dehors du contexte web, évitez d’abuser des pipelines si un simple appel direct suffit. Inutile de sur-architecturer une simple séquence d’appels en pipeline ultra-générique si elle ne sera jamais modifiée. Pour ASP.NET, faites attention à l’ordre des middlewares : une mauvaise ordre (par exemple placer l’authentification après le routing alors qu’on en a besoin avant) peut causer des bugs subtils. Ce n’est pas tant le pattern en lui-même qu’il faut éviter, mais plutôt sa mauvaise configuration.</p><p><strong>Intégration .NET 👩‍💻 :</strong> Pour ASP.NET Core, l’intégration est native (méthodes <code class="language-plaintext highlighter-rouge">UseMiddleware&lt;T&gt;()</code>, etc.). Vous pouvez profiter de l’injection de dépendances <em>dans</em> vos middlewares en définissant un constructeur qui prend les services voulus (le framework les injectera). Ainsi votre middleware peut très bien être un décorateur qui utilise un service de cache ou un repo injecté du container. Enfin, notez que d’autres librairies adoptent ce pattern de pipeline configurable : citons <strong>MediatR</strong> (avec ses Pipeline Behaviors qui agissent autour des requêtes MediatR), ou <strong>Message delegating handlers</strong> pour HttpClient. Comprendre le fonctionnement des middlewares vous aidera donc dans de nombreux recoins du framework .NET.</p><h2 id="mediator-un-hub-pour-la-communication-grâce-à-mediatr"><span class="mr-2">Mediator : un <strong>hub</strong> pour la communication, grâce à MediatR</span><a href="#mediator-un-hub-pour-la-communication-grâce-à-mediatr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Le pattern <strong>Mediator</strong> définit un objet intermédiaire qui <strong>centralise les communications</strong> entre plusieurs composants au lieu qu’ils interagissent directement. Imaginez une tour de contrôle d’aéroport : les avions (composants) ne se parlent pas entre eux en direct, ils parlent tous à la tour (médiateur) qui coordonne tout. Cela réduit le couplage : chaque objet a juste à connaître le médiateur, pas les détails des autres.</p><p>En .NET, on utilise fréquemment une librairie nommée <strong>MediatR</strong> (de Jimmy Bogard) pour implémenter ce pattern. MediatR permet d’envoyer des <strong>requêtes/commandes</strong> et de les faire traiter par un ou plusieurs <strong>handlers</strong> enregistrés, sans que l’émetteur et le récepteur se connaissent.</p><h3 id="exemple-concret-5"><span class="mr-2">Exemple concret</span><a href="#exemple-concret-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Dans une application de gestion d’inventaire, imaginons qu’on veuille décoller la logique métier des contrôleurs API. On peut définir une commande du domaine, par exemple <code class="language-plaintext highlighter-rouge">AjouterProduitCommand</code> (avec les infos du produit), et un handler associé <code class="language-plaintext highlighter-rouge">AjouterProduitHandler</code> qui contient la logique pour ajouter le produit (vérifier stock, enregistrer en base de données, etc.). Le contrôleur va juste <em>envoyer</em> la commande via le médiateur, qui lui se charge de trouver et exécuter le handler adéquat.</p><p>Avec MediatR, cela se traduit par :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">// Définition d'une commande (implémente IRequest&lt;T&gt; de MediatR)</span>
<span class="k">public</span> <span class="k">record</span> <span class="nc">AjouterProduitCommand</span><span class="p">(</span><span class="kt">string</span> <span class="n">Reference</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Quantite</span><span class="p">)</span> <span class="p">:</span> <span class="n">IRequest</span><span class="p">&lt;</span><span class="n">ResultatProduit</span><span class="p">&gt;;</span>

<span class="c1">// Implémentation du handler pour cette commande</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">AjouterProduitHandler</span> <span class="p">:</span> <span class="n">IRequestHandler</span><span class="p">&lt;</span><span class="n">AjouterProduitCommand</span><span class="p">,</span> <span class="n">ResultatProduit</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IProduitRepository</span> <span class="n">_produitRepository</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">AjouterProduitHandler</span><span class="p">(</span><span class="n">IProduitRepository</span> <span class="n">produitRepository</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_produitRepository</span> <span class="p">=</span> <span class="n">produitRepository</span><span class="p">;</span>
    <span class="p">}</span> 

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ResultatProduit</span><span class="p">&gt;</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">AjouterProduitCommand</span> <span class="n">command</span><span class="p">,</span>
       <span class="n">CancellationToken</span> <span class="n">cancellationToken</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Produit</span> <span class="n">prod</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Produit</span>
        <span class="p">{</span> 
            <span class="n">Reference</span> <span class="p">=</span> <span class="n">command</span><span class="p">.</span><span class="n">Reference</span><span class="p">,</span>
            <span class="n">Quantite</span> <span class="p">=</span> <span class="n">command</span><span class="p">.</span><span class="n">Quantite</span>
        <span class="p">};</span>

        <span class="k">await</span> <span class="n">_produitRepository</span><span class="p">.</span><span class="nf">Ajouter</span><span class="p">(</span><span class="n">prod</span><span class="p">,</span> <span class="n">cancellationToken</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResultatProduit</span><span class="p">(</span><span class="n">prod</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="s">"Produit ajouté avec succès"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Dans le contrôleur (ou n’importe quel endroit du code) qui a besoin d’ajouter un produit, on ferait :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// _mediator est injecté via IMediator de MediatR</span>
<span class="kt">var</span> <span class="n">resultat</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_mediator</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="k">new</span> <span class="nf">AjouterProduitCommand</span><span class="p">(</span><span class="s">"REF123"</span><span class="p">,</span> <span class="m">50</span><span class="p">));</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">resultat</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
</pre></table></code></div></div><p>Ici, <code class="language-plaintext highlighter-rouge">_mediator.Send(...)</code> va en coulisses trouver le <code class="language-plaintext highlighter-rouge">AjouterProduitHandler</code> (grâce au container IoC et MediatR), exécuter sa méthode <code class="language-plaintext highlighter-rouge">Handle</code>, et renvoyer le résultat. Le contrôleur n’a aucune référence directe sur le handler ou le repository, il passe par le médiateur.</p><p><strong>Quand l’utiliser 🟢 :</strong> Lorsque vous voulez <strong>découpler</strong> fortement les composants qui interagissent. Le Mediator est roi dans les architectures <strong>CQRS</strong> / <strong>Médiation</strong> : il permet d’envoyer des <em>Commandes</em> et <em>Query</em> sans lier le code d’envoi et le code de traitement. Utile aussi pour implémenter un système de <strong>notifications/événements internes</strong> : par exemple, plusieurs parties de l’application écoutent un événement via Mediator (avec MediatR ce sont les <code class="language-plaintext highlighter-rouge">INotification</code> et leurs handlers multiples). En somme, dès que votre application commence à ressembler à un enchevêtrement de signaux entre modules, introduire un médiateur peut apporter de la lisibilité et une architecture en étoile plutôt qu’en plat de nouilles.</p><p><strong>À éviter 🔴 :</strong> Si le trafic via le médiateur devient trop centralisé, le Mediator peut lui-même devenir un goulot d’étranglement ou un <em>god object</em> déguisé (ex: un seul mediator gigantesque qui sait trop de choses). Il faut l’utiliser pour ce qu’il fait bien : la <strong>découplage de l’envoi et du traitement</strong>. Si deux composants sont naturellement faits pour interagir directement (faible couplage, usage local), inutile de forcer le passage par un médiateur. Par ailleurs, un excès de médiation peut compliquer le suivi du flux d’appel (on perd un peu la trace de “qui appelle qui” car tout passe par le hub central). Comme toujours, c’est un équilibre.</p><p><strong>Intégration .NET 👩‍💻 :</strong> L’intégration de MediatR en .NET Core est très simple : on installe le package, puis dans <code class="language-plaintext highlighter-rouge">Program.cs</code> on fait <code class="language-plaintext highlighter-rouge">services.AddMediatR(cfg =&gt; cfg.RegisterServicesFromAssemblyContaining&lt;Program&gt;());</code> (ou équivalent) pour enregistrer tous les handlers du projet. MediatR utilise le container IoC pour résoudre les handlers. On peut configurer des comportements additionnels (les fameux Pipeline Behaviors mentionnés plus haut, qui permettent d’implémenter des cross-cutting concerns autour des requêtes Mediator, comme la validation, le logging, etc. – c’est en fait un Chain of Responsibility autour du Mediator!).</p><p>Avec MediatR, on peut envoyer des commandes synchrones ou asynchrones, des requêtes qui attendent une réponse, ou des notifications sans réponse (pub/sub interne). C’est un outil formidable pour structurer du code métier dans les applications de gestion, en appliquant les principes <strong>CQRS</strong> (séparer écriture/lecture) et <strong>Clean Architecture</strong>. À noter : plusieurs implémentations du pattern Mediator existent dans l’écosystème .NET. Il est possible d’en coder une version minimaliste maison, ou d’utiliser des bibliothèques comme <code class="language-plaintext highlighter-rouge">MediatR</code>, qui a longtemps été une référence. <strong>Toutefois, attention : MediatR qui sera prochainement sous <a href="https://www.jimmybogard.com/automapper-and-mediatr-going-commercial/">licence commerciale</a></strong>, ce qui <strong>limite son usage dans les projets professionnels</strong>.</p><h2 id="builder-construction-pas-à-pas-et-syntaxe-fluide"><span class="mr-2">Builder : construction pas-à-pas et syntaxe fluide</span><a href="#builder-construction-pas-à-pas-et-syntaxe-fluide" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Le Builder pattern sépare la construction d’un objet complexe de sa représentation. Ici, le <code class="language-plaintext highlighter-rouge">Director</code> utilise un <code class="language-plaintext highlighter-rouge">Builder</code> (fluent) pour assembler un <code class="language-plaintext highlighter-rouge">Product</code> étape par étape.</em></p><p>Dernier pattern mais non des moindres : <strong>Builder</strong>. Si je vous dis <em>« constructeur avec 12 paramètres »</em>, vous me dites 🤮. En effet, quand un objet possède beaucoup de propriétés optionnelles, le passage de paramètres devient illisible et sujet à erreur. Le Builder vient à la rescousse en fournissant une <strong>interface de construction progressive (souvent fluide)</strong>. On crée l’objet en plusieurs étapes, via des méthodes dédiées, plutôt qu’un seul gros constructeur. C’est un peu le mode d’emploi Ikea : on assemble pièce par pièce, et à la fin on obtient le meuble.</p><h3 id="exemple-concret-6"><span class="mr-2">Exemple concret</span><a href="#exemple-concret-6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Dans une application de gestion, imaginons un module de génération de <strong>rapport PDF</strong> complexe (par exemple un rapport d’activité mensuel avec plusieurs sections, en-tête, pied de page, etc.). Plutôt que d’avoir une méthode géante qui prend 20 arguments pour tout configurer, on va utiliser un <code class="language-plaintext highlighter-rouge">ReportBuilder</code> qui va fournir des méthodes pour ajouter les différentes parties du rapport de manière lisible.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Report</span> 
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Titre</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Sections</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">PiedDePage</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">// ... éventuellement d'autres propriétés complexes (graphique, tableau, etc.)</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ReportBuilder</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Report</span> <span class="n">_report</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Report</span><span class="p">();</span>

    <span class="k">public</span> <span class="n">ReportBuilder</span> <span class="nf">Titre</span><span class="p">(</span><span class="kt">string</span> <span class="n">titre</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_report</span><span class="p">.</span><span class="n">Titre</span> <span class="p">=</span> <span class="n">titre</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="c1">// on retourne le builder pour chaîner</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">ReportBuilder</span> <span class="nf">AjouterSection</span><span class="p">(</span><span class="kt">string</span> <span class="n">contenuSection</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_report</span><span class="p">.</span><span class="n">Sections</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">contenuSection</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">ReportBuilder</span> <span class="nf">PiedDePage</span><span class="p">(</span><span class="kt">string</span> <span class="n">textePied</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_report</span><span class="p">.</span><span class="n">PiedDePage</span> <span class="p">=</span> <span class="n">textePied</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Report</span> <span class="nf">Build</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_report</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Utilisation en syntaxe fluide (fluent interface) :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">Report</span> <span class="n">rapport</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ReportBuilder</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">Titre</span><span class="p">(</span><span class="s">"Rapport d’activité - Mars 2025"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">AjouterSection</span><span class="p">(</span><span class="s">"Chiffre d'affaires : 1M €"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">AjouterSection</span><span class="p">(</span><span class="s">"Nouveaux clients : 50"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">PiedDePage</span><span class="p">(</span><span class="s">"Confidentiel - interne"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">Build</span><span class="p">();</span>
</pre></table></code></div></div><p>On lit quasiment du français dans le code ! On a progressivement construit l’objet <code class="language-plaintext highlighter-rouge">rapport</code> sans se soucier de l’ordre interne des initialisations ni d’oublier un paramètre requis. Le Builder encapsule la logique d’assemblage (ici triviale, mais elle pourrait être plus complexe avec par exemple calcul de totaux en interne avant <code class="language-plaintext highlighter-rouge">Build</code>).</p><p><strong>Quand l’utiliser 🟢 :</strong> Quand la création d’un objet est <strong>complexe</strong>, c’est-à-dire :</p><ul><li>comporte de <strong>nombreux paramètres</strong> (optionnels ou obligatoires) rendant un constructeur classique impraticable ou ambigu,<li>nécessite des <strong>étapes</strong> multiples (par exemple certaines parties doivent être construites avant d’autres),<li>ou quand on veut offrir à l’API utilisateur une <strong>syntaxe fluide</strong> très lisible pour configurer un objet.</ul><p>Les cas d’utilisation concrets abondent en applications de gestion : construction d’un rapport comme vu, configuration dynamique d’un objet de paramétrage, montage d’une requête SQL/ElasticSearch complexe via un QueryBuilder, etc. Le Builder pattern permet aussi d’isoler la logique de création en un point unique (respect du single responsibility).</p><p><strong>À éviter 🔴 :</strong> Si l’objet à créer est simple (quelques paramètres), un constructeur ou les <strong>object initializers</strong> de C# (init { Prop1 = …, Prop2 = … }) suffisent amplement. Le Builder, s’il est mal conçu, peut également laisser l’objet dans un état partiel incohérent tant que <code class="language-plaintext highlighter-rouge">Build()</code> n’a pas été appelé – attention donc à garantir une utilisation correcte (parfois on marque le constructeur de l’objet cible internal pour forcer le passage par le builder). Évitez aussi le builder juste pour faire du <em>fluent</em> sur des opérations statiques ou non liées à un objet complexe — là c’est le nom qui peut prêter à confusion : <em>Builder</em> sert vraiment à construire un objet.</p><p><strong>Intégration .NET 👩‍💻 :</strong> La <em>syntaxe fluide</em> (fluent syntax) est très répandue dans l’écosystème .NET moderne, souvent inspirée du Builder pattern. Par exemple, les <em>Options</em> de configuration se construisent via des <code class="language-plaintext highlighter-rouge">optionsBuilder.AddX()</code> en chaîne, les requêtes LINQ en chaîne, l’API Fluent Validation (<code class="language-plaintext highlighter-rouge">RuleFor(x =&gt; x.Name).NotEmpty().WithMessage("...")</code>), etc. Sans être toujours de purs “Builders”, ces syntaxes fluides améliorent la lisibilité et l’enchaînement d’appels.</p><p>En interne, .NET utilise aussi le Builder pattern pour la construction de gros objets comme l’<strong><code class="language-plaintext highlighter-rouge">HostBuilder</code> / <code class="language-plaintext highlighter-rouge">WebApplicationBuilder</code></strong> (qui configureront étape par étape votre application).</p><p>Côté IoC, un Builder est souvent créé via une factory ou fourni par un framework. On ne l’enregistre généralement pas dans le container (on crée le builder quand on en a besoin, puis on jette). Toutefois, rien n’empêche d’injecter un builder pré-configuré si cela a du sens dans votre design.</p><p>En résumé, le Builder est un peu l’inverse du Factory : on l’utilise pour composer <strong>petit à petit</strong> un objet complexe, là où la Factory crée d’emblée un objet souvent simple ou retourne une implémentation. Avec le Builder pattern, on prend le temps d’assembler et grâce au <em>fluent interface</em>, le code appelant est clair et expressif.</p><h2 id="conclusion-choisir-le-bon-pattern-au-bon-moment"><span class="mr-2">Conclusion : Choisir le bon pattern au bon moment</span><a href="#conclusion-choisir-le-bon-pattern-au-bon-moment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nous avons fait un tour d’horizon de plusieurs design patterns clés en .NET Core. Chaque pattern est un <strong>outil</strong> dans votre boîte à outils : il a un usage privilégié, des avantages, des inconvénients. L’art de l’architecture logicielle consiste à choisir <em>le bon Lego au bon moment</em>. Il n’y a pas de solution universelle : parfois un simple <code class="language-plaintext highlighter-rouge">if</code> vaut mieux qu’un Strategy surdimensionné, parfois un Mediator apporte une structure bienvenue là où le couplage devenait ingérable.</p><p>Un conseil : <strong>entraînez-vous</strong> à reconnaître dans votre code ou dans les frameworks que vous utilisez quels patterns sont à l’œuvre. Vous verrez que ASP.NET Core, Entity Framework, etc., sont truffés de ces concepts (Singletons pour les services, Factory methods pour les DbContext, Decorators dans les pipeline, etc.). Comprendre les design patterns vous permettra non seulement de mieux utiliser les API .NET, mais aussi de concevoir vos propres composants de manière élégante et maintenable.</p><p>Enfin, pour aller plus loin, je le redis, la <a href="https://www.youtube.com/watch?v=v9ejT8FO-7I&amp;list=PLrhzvIcii6GNjpARdnO4ueTUAVR9eMBpc">série</a> de <strong>Christopher Okhravi</strong> sur YouTube est un excellent complément visuel et pédagogique, avec une touche d’humour qui, je l’espère, aura fait écho à la lecture de cet article. 😉</p><p>En maîtrisant ces patterns, vous éviterez de réinventer la roue carrée et vous construirez des applications évolutives <em>brique par brique</em>. Alors à vos Legos, prêts, codez ! 🚀</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/architecture/'>architecture</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Cet article est sous licence <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> par l'auteur.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Partager</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Les%20design%20patterns%C2%A0-%20les%20bons%20Legos%20pour%20vos%20applications%20.NET%20-%20CodeWithFrenchy&url=https%3A%2F%2Fcodewithfrenchy.github.io%2F%2Fposts%2Futilisation-design-patterns%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcodewithfrenchy.github.io%2F%2Fposts%2Futilisation-design-patterns%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Les%20design%20patterns%C2%A0-%20les%20bons%20Legos%20pour%20vos%20applications%20.NET%20-%20CodeWithFrenchy&u=https%3A%2F%2Fcodewithfrenchy.github.io%2F%2Fposts%2Futilisation-design-patterns%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copier le lien" data-title-succeed="Lien copié avec succès!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Récemment mis à jour</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/performances-jsonserializeroptions-singleton/">Amélioration des performances en utilisant JsonSerializerOptions en singleton</a><li><a href="/posts/source-generator-dotnet/">Les Générateurs de source</a><li><a href="/posts/guid-versus-id/">GUID vs ID auto-incrémenté - dilemme et solutions en environnement .NET distribué</a><li><a href="/posts/introduction-k6/">Introduction à K6</a><li><a href="/posts/redis-change-licence/">Redis change de licence ! Quelles répercussions pour les développeurs et les entreprises ?</a></ul></div><div id="access-tags"><div class="panel-heading">Tags tendance</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/conference/">conference</a> <a class="post-tag" href="/tags/essais/">essais</a> <a class="post-tag" href="/tags/source-generator/">source-generator</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet-core</a> <a class="post-tag" href="/tags/fluentassertions/">fluentassertions</a> <a class="post-tag" href="/tags/fluentvalidation/">fluentvalidation</a> <a class="post-tag" href="/tags/k6/">k6</a> <a class="post-tag" href="/tags/mapperly/">mapperly</a> <a class="post-tag" href="/tags/testcontainers/">testcontainers</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenu</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Autres lectures</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/vertical-slice-architecture/"><div class="card-body"> <em class="small" data-ts="1751241600" data-df="DD/MM/YYYY" > 29/06/2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Architecture Vertical Slice dans l’écosystème .NET</h3><div class="text-muted small"><p> L’architecture Vertical Slice (ou architecture en tranches verticales) est une approche de conception logicielle qui consiste à organiser le code par fonctionnalités verticales plutôt que par couch...</p></div></div></a></div><div class="card"> <a href="/posts/quand-utiliser-architecture-microservices/"><div class="card-body"> <em class="small" data-ts="1757376000" data-df="DD/MM/YYYY" > 08/09/2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Faut-il vraiment adopter une architecture microservices</h3><div class="text-muted small"><p> Préambule “On part en microservices ou on reste monolithique ?” C’est une des questions les plus posées et les moins bien tranchées du monde logiciel. Une question qui revient à chaque projet...</p></div></div></a></div><div class="card"> <a href="/posts/concevoir-maintenir-application-performante-dotnet/"><div class="card-body"> <em class="small" data-ts="1761001200" data-df="DD/MM/YYYY" > 20/10/2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Concevoir et maintenir des applications microservices performantes en .NET</h3><div class="text-muted small"><p> La performance logicielle ne doit pas être une réflexion après coup : elle se conçoit dès le départ et se cultive tout au long de la vie du système. Dans cet article, nous explorons comment s’outil...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/quand-utiliser-architecture-microservices/" class="btn btn-outline-primary" prompt="Plus ancien"><p>Faut-il vraiment adopter une architecture microservices</p></a> <a href="/posts/dotnet10/" class="btn btn-outline-primary" prompt="Plus récent"><p>.NET 10 - Nouveautés, Performances et Support Prolongé</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Tags tendance</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/conference/">conference</a> <a class="post-tag" href="/tags/essais/">essais</a> <a class="post-tag" href="/tags/source-generator/">source-generator</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet-core</a> <a class="post-tag" href="/tags/fluentassertions/">fluentassertions</a> <a class="post-tag" href="/tags/fluentvalidation/">fluentvalidation</a> <a class="post-tag" href="/tags/k6/">k6</a> <a class="post-tag" href="/tags/mapperly/">mapperly</a> <a class="post-tag" href="/tags/testcontainers/">testcontainers</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/alexis35115">Alexis Garon-Michaud</a>. <span data-toggle="tooltip" data-placement="top" title="Sauf mention contraire, les articles de ce site sont publiés sous licence sous la licence Creative Commons Attribution 4.0 International (CC BY 4.0) par l'auteur.">Certains droits réservés.</span></p></div><div class="footer-right"><p class="mb-0">Propulsé par <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> avec le thème <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oups! Aucun résultat trouvé.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/fr.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
