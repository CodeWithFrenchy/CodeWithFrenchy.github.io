<!DOCTYPE html><html lang="fr-FR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Essais automatisés d’architecture dans un projet .NET" /><meta property="og:locale" content="fr_FR" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://codewithfrenchy.github.io//posts/essais-architecture-automatises-dotnet/" /><meta property="og:url" content="https://codewithfrenchy.github.io//posts/essais-architecture-automatises-dotnet/" /><meta property="og:site_name" content="CodeWithFrenchy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-11-03T18:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Essais automatisés d’architecture dans un projet .NET" /><meta name="twitter:site" content="@alexis35115" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-11-03T19:18:45-05:00","datePublished":"2025-11-03T18:00:00-05:00","description":"Introduction","headline":"Essais automatisés d’architecture dans un projet .NET","mainEntityOfPage":{"@type":"WebPage","@id":"https://codewithfrenchy.github.io//posts/essais-architecture-automatises-dotnet/"},"url":"https://codewithfrenchy.github.io//posts/essais-architecture-automatises-dotnet/"}</script><title>Essais automatisés d’architecture dans un projet .NET | CodeWithFrenchy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CodeWithFrenchy"><meta name="application-name" content="CodeWithFrenchy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/53872142?s=400&u=53187283fe05254234a3890e2b44134f96e3a833&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">CodeWithFrenchy</a></div><div class="site-subtitle font-italic">Architecte logiciel, audacieux et fermier</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>ACCUEIL</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATÉGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>À PROPOS DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/alexis35115" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexis35115" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/alexis-garon-michaud-a59643219/" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Accueil </a> </span> <span>Essais automatisés d’architecture dans un projet .NET</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Recherche..."> </span> <span id="search-cancel" >Annuler</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Essais automatisés d’architecture dans un projet .NET</h1><div class="post-meta text-muted"> <span> Posté <em class="" data-ts="1762210800" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 03/11/2025 </em> </span> <span> Mis à jour <em class="" data-ts="1762215525" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 03/11/2025 </em> </span><div class="d-flex justify-content-between"> <span> Par <em> <a href="https://twitter.com/alexis35115">Alexis Garon-Michaud</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2543 mots"> <em>14 min</em> à lire</span></div></div></div><div class="post-content"><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Dans les projets .NET complexes, par exemple appliquant le <em>Domain-Driven Design (DDD)</em> ou une <em>Clean Architecture</em> stricte, il devient crucial de s’assurer que la structure du code respecte en permanence les règles d’architecture prévues. À mesure qu’une base de code grandit et que de nombreux développeurs contribuent, le risque de dérive architecturale augmente : sans contrôle, on peut introduire des dépendances entre couches qui violent le design initial, avec à la clé une perte de maintenabilité et de lisibilité du code. L’idéal serait de <strong>valider automatiquement l’architecture</strong> pour prévenir ces dérives dès qu’elles apparaissent.</p><p><em>Exemple de représentation Clean Architecture en cercles concentriques (modèle Onion)</em>. Les dépendances pointent vers le noyau du système : la partie cœur métier au centre n’a aucune dépendance sur les couches extérieures, tandis que les couches externes (UI, Infrastructure) peuvent dépendre de ce qui est plus central.</p><p>Dans une architecture de type <em>Clean Architecture</em>, on s’attend par exemple à ce que la couche <em>Domaine</em> ou <em>Application Core</em> ne dépende d’aucun détail d’infrastructure ou d’interface utilisateur. Ce sont au contraire les couches extérieures (UI, Infrastructure) qui dépendent des abstractions du domaine. Cette organisation en couches strictes assure une meilleure encapsulation : si l’on change l’implémentation de la persistance des données ou du framework de présentation, le cœur de l’application n’en souffre pas. Pour garantir cela dans la durée, les équipes matures mettent en place des <strong>tests automatisés d’architecture</strong> qui vont vérifier en continu que ces règles de dépendances et de structure sont bien respectées.</p><h2 id="pourquoi-des-tests-darchitecture-automatisés-"><span class="mr-2">Pourquoi des tests d’architecture automatisés ?</span><a href="#pourquoi-des-tests-darchitecture-automatisés-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Chaque équipe définit des conventions sur la façon d’organiser le code. Souvent ces règles sont documentées sur un wiki ou transmises oralement, mais on sait que les développeurs lisent peu la documentation et que ces règles “non écrites” finissent par varier d’une personne à l’autre. Les revues de code peuvent attraper certains écarts, mais ce processus manuel est lent, fastidieux, et laisse place à des incohérences.</p><p>Automatiser la vérification de l’architecture apporte une solution élégante : on transforme ces conventions en tests unitaires <em>exécutables</em>. Ainsi, les règles d’architecture de l’équipe sont “gravées dans le marbre” et ne peuvent plus être ignorées ou mal interprétées. Quand un nouveau développeur rejoint le projet ou qu’une refactorisation majeure a lieu, les tests d’architecture servent de garde-fous immédiats.</p><p>Les avantages sont multiples : cela crée une <strong>documentation vivante</strong> des décisions d’architecture (les tests décrivent les contraintes à respecter dans le code). On bénéficie des mêmes gains que pour les autres tests automatisés : gain de temps et retour rapide en cas de régression, sans devoir jouer en permanence le rôle du <em>gendarme</em> en revue de code. L’application des règles devient uniforme pour tous les membres de l’équipe, améliorant la cohérence du code. En attrapant très tôt les violations (dès le build ou la PR), on évite que des erreurs de conception ne s’accumulent et ne transforment le code en un “<em>big ball of mud</em>” ingérable sur le long terme. En résumé, ces tests automatisés sécurisent vos refactorings et garantissent l’intégrité architecturale du système dans la durée.</p><h2 id="tour-dhorizon-des-outils-disponibles"><span class="mr-2">Tour d’horizon des outils disponibles</span><a href="#tour-dhorizon-des-outils-disponibles" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En environnement .NET, deux principales bibliothèques se partagent le domaine des tests d’architecture automatisés : <strong>NetArchTest</strong> et <strong>ArchUnitNET</strong>.</p><p><a href="https://github.com/BenMorris/NetArchTest">NetArchTest</a> est un outil qui fournit une API fluide pour définir des règles architecturales sous forme de tests unitaires. Il permet par exemple d’exprimer qu’une classe de service ne doit pas dépendre d’un contrôleur, ou qu’une classe de la couche <em>Domaine</em> ne doit pas se trouver dans le namespace de l’Infrastructure. Cependant, NetArchTest semble en perte de vitesse, aucune mise à jour n’a été publiée depuis 2023, le dépôt GitHub n’ayant plus de commits depuis plus de deux ans. Cela laisse penser que l’outil n’est plus activement maintenu.</p><p><a href="https://github.com/TNG/ArchUnitNET">ArchUnitNET</a>, de son côté, est une librairie plus récente et soutenue par la communauté (créée par TNG Tech) pour tester l’architecture des applications C#. C’est un portage de l’outil Java <strong>ArchUnit</strong>, bien connu dans l’écosystème JVM. ArchUnitNET permet de définir via une API <em>fluent</em> des contraintes solides entre vos classes, modules et namespaces, et de valider automatiquement que votre code reste conforme à l’architecture voulue. L’outil est open-source (Apache 2.0) et bénéficie d’un support actif : au moment où j’écris, le dépôt reçoit des contributions régulières (dernier commit il y a seulement quelques heures !). Face à un NetArchTest vieillissant, le choix d’ArchUnitNET s’est imposé pour notre projet.</p><h2 id="pourquoi-jai-choisi-archunitnet"><span class="mr-2">Pourquoi j’ai choisi ArchUnitNET</span><a href="#pourquoi-jai-choisi-archunitnet" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Voici les principaux atouts qui nous ont fait adopter <strong>ArchUnitNET</strong> :</p><ul><li><strong>Support actif et pérennité</strong> – ArchUnitNET est activement maintenu par ses contributeurs et aligné sur ArchUnit (Java) qui fait référence. On évite ainsi le risque d’un outil abandonné en rase campagne à l’inverse de NetArchTest, resté figé depuis 2023. La fréquence des commits et des releases d’ArchUnitNET témoigne d’une communauté dynamique (dernière <em>release</em> très récente, projet mis à jour en continu).<li><strong>API fluide et expressive</strong> – La syntaxe proposée par ArchUnitNET est à la fois puissante et lisible. Elle permet de définir finement des règles d’architecture en code C# clair, grâce à un DSL (<em>Domain-Specific Language</em>) interne inspiré de ArchUnit Java. Par exemple, on peut écrire que <em>” les classes du namespace X devraient résider dans telle couche et ne pas dépendre de tel autre namespace “</em> en une seule ligne expressive. Cette API fluent rend la création de règles assez naturelle, tout en produisant des messages d’erreur explicites en cas de non-respect (on peut même ajouter un commentaire avec Because(“raison”) pour documenter la règle violée).<li><strong>Intégration facile dans le projet</strong> – ArchUnitNET s’installe comme n’importe quel package NuGet et s’utilise au sein de vos projets de tests existants. Il propose des extensions pour les frameworks de tests populaires (xUnit, NUnit, MSTest) afin de s’intégrer au mieux dans votre pipeline de tests. En pratique, il suffit d’ajouter le package NuGet et de charger les assemblys de votre application dans le moteur ArchUnitNET, puis d’écrire des tests classiques qui exécutent les vérifications d’architecture. Aucune étape lourde ou outil externe n’est requis, ce qui rend son adoption très simple.<li><strong>Portée fonctionnelle</strong> – ArchUnitNET couvre un large éventail de possibilités : contrôle des dépendances entre assemblies/namespaces, conventions de nommage des classes, structure des couches, règles sur l’héritage, présence d’attributs spécifiques, etc. Cette richesse permet de traduire pratiquement toutes les règles d’architecture imaginables en tests automatisés. De plus, étant un port direct d’ArchUnit, on bénéficie d’un certain recul et de bonnes pratiques déjà éprouvées.</ul><p>En résumé, ArchUnitNET s’est distingué pour nous par son <strong>support actif</strong>, son <strong>expressivité</strong> et sa <strong>facilité d’adoption</strong> dans notre écosystème .NET, ce qui en fait un choix de confiance pour automatiser nos tests d’architecture.</p><h2 id="exemple-complet-avec-archunitnet"><span class="mr-2">Exemple complet avec ArchUnitNET</span><a href="#exemple-complet-avec-archunitnet" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Pour illustrer l’utilisation d’ArchUnitNET, prenons un exemple fictif de projet .NET organisé selon une architecture en couches façon <em>Clean Architecture</em>. Imaginons une application <strong>API Web</strong> qui comporte trois couches principales : <strong>Application</strong>, <strong>Domaine</strong>, <strong>Infrastructure</strong>.</p><ul><li>La couche <em>Application</em> contient la logique applicative (cas d’usage, services applicatifs) et dépend du <em>Domaine</em>.<li>La couche <em>Domaine</em> encapsule les règles métiers (entités, agrégats, interfaces de référentiels, etc.) et est indépendante.<li>La couche <em>Infrastructure</em> fournit les implémentations concrètes (accès aux données, services externes) et dépend de <em>Application</em> et <em>Domaine</em>.<li>L’API (controllers web) fait office de couche de présentation et interagit avec <em>Application</em>.</ul><p>Notre objectif est d’écrire des tests pour vérifier automatiquement quelques règles d’architecture de ce projet :</p><ol><li><strong>Indépendance des couches</strong> - Par exemple, la couche <em>Application</em> ne doit <strong>jamais</strong> dépendre directement de la couche <em>Infrastructure</em>. Ainsi, aucune classe du namespace <code class="language-plaintext highlighter-rouge">MonProjet.Application</code> ne doit référencer une classe de <code class="language-plaintext highlighter-rouge">MonProjet.Infrastructure</code> (respect de la dépendance inverse).<li><strong>Conventions de localisation</strong> – Les classes de contrôleur ASP.NET (suffixées par <code class="language-plaintext highlighter-rouge">Controller</code>) doivent résider dans le namespace <code class="language-plaintext highlighter-rouge">MonProjet.Api.Controllers</code> prévu à cet effet, et pas ailleurs.</ol><p>Commençons par installer ArchUnitNET dans notre projet de tests. Si vous utilisez <strong>xUnit</strong>, je vous recommande l’extension dédiée ArchUnitNET.xUnit qui fournit tout le nécessaire pour écrire des <code class="language-plaintext highlighter-rouge">[Fact]</code> vérifiant l’architecture :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dotnet add package TngTech.ArchUnitNET.xUnit
</pre></table></code></div></div><p>Une fois le package ajouté, nous allons pouvoir définir l’architecture à analyser dans nos tests. ArchUnitNET va charger nos assemblies (.dll) et construire un modèle interne des types et de leurs dépendances. On peut ensuite formuler des règles via l’API fluent. Typiquement, on crée une classe de test <em>ArchitectureTests</em> où l’on initialise en static l’objet Architecture et éventuellement quelques <em>providers</em> de types réutilisables représentant nos couches :</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copié!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">ArchUnitNET.Domain</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ArchUnitNET.Loader</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ArchUnitNET.Fluent</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">static</span> <span class="n">ArchUnitNET</span><span class="p">.</span><span class="n">Fluent</span><span class="p">.</span><span class="n">ArchRuleDefinition</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MonProjet.ArchTests</span>
<span class="p">{</span>
    <span class="c1">// Chargement initial de l'architecture (assemblies Application, Domain, Infrastructure)</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ArchitectureTests</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Architecture</span> <span class="n">Architecture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ArchLoader</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">LoadAssemblies</span><span class="p">(</span>
                <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"MonProjet.Application"</span><span class="p">),</span>
                <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"MonProjet.Domain"</span><span class="p">),</span>
                <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">"MonProjet.Infrastructure"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

        <span class="c1">// Définition de "filtres" réutilisables pour nos couches</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IObjectProvider</span><span class="p">&lt;</span><span class="n">IType</span><span class="p">&gt;</span> <span class="n">ApplicationLayer</span> <span class="p">=</span> 
            <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">"MonProjet.Application"</span><span class="p">).</span><span class="nf">As</span><span class="p">(</span><span class="s">"Couche Application"</span><span class="p">);</span>

        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IObjectProvider</span><span class="p">&lt;</span><span class="n">IType</span><span class="p">&gt;</span> <span class="n">InfrastructureLayer</span> <span class="p">=</span> 
            <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">"MonProjet.Infrastructure"</span><span class="p">).</span><span class="nf">As</span><span class="p">(</span><span class="s">"Couche Infrastructure"</span><span class="p">);</span>

        <span class="c1">// ... on pourrait définir de même DomainLayer, etc.</span>

        <span class="c1">// 1. Test de règle d'architecture : Application ne dépend pas d'Infrastructure</span>
        <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Application_NeDoitPasDependre_DeInfrastructure</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">IArchRule</span> <span class="n">regleCoucheApp</span> <span class="p">=</span>
                <span class="nf">Types</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">Are</span><span class="p">(</span><span class="n">ApplicationLayer</span><span class="p">)</span>
                      <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">NotDependOnAny</span><span class="p">(</span><span class="n">InfrastructureLayer</span><span class="p">)</span>
                      <span class="p">.</span><span class="nf">Because</span><span class="p">(</span><span class="s">"la couche Application doit rester indépendante de l'Infrastructure"</span><span class="p">);</span>

            <span class="n">regleCoucheApp</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">Architecture</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// 2. Test de convention : les Controllers sont dans le namespace MonProjet.Api.Controllers</span>
        <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Controllers_DansNamespaceControllers</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">IArchRule</span> <span class="n">regleControllers</span> <span class="p">=</span>
                <span class="nf">Classes</span><span class="p">().</span><span class="nf">That</span><span class="p">().</span><span class="nf">HaveNameEndingWith</span><span class="p">(</span><span class="s">"Controller"</span><span class="p">)</span>
                        <span class="p">.</span><span class="nf">Should</span><span class="p">().</span><span class="nf">ResideInNamespace</span><span class="p">(</span><span class="s">"MonProjet.Api.Controllers"</span><span class="p">)</span>
                        <span class="p">.</span><span class="nf">Because</span><span class="p">(</span><span class="s">"les contrôleurs web doivent être déclarés dans MonProjet.Api.Controllers"</span><span class="p">);</span>

            <span class="n">regleControllers</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">Architecture</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Dans le premier test (<code class="language-plaintext highlighter-rouge">Application_NeDoitPasDependre_DeInfrastructure</code>), on utilise la méthode fluide <code class="language-plaintext highlighter-rouge">Types().That().Are(ApplicationLayer)</code> pour sélectionner tous les types de la couche Application, puis on exprime la contrainte <code class="language-plaintext highlighter-rouge">Should().NotDependOnAny(InfrastructureLayer)</code>. Autrement dit, aucun de ces types ne doit avoir de dépendance vers un type de la couche <strong>Infrastructure</strong>, ce qui empêche par exemple une classe applicative d’utiliser directement un repository concret défini dans l’infrastructure. Le <code class="language-plaintext highlighter-rouge">.Because("...")</code> permet d’ajouter un message explicatif qui s’affichera si la règle est violée, ce qui documente le pourquoi de la contrainte (ici “la couche Application doit rester indépendante”). Enfin, on termine par Check(Architecture) pour exécuter la règle sur l’architecture chargée. Si une dépendance interdite est détectée, le test échouera en listant précisément quelles classes posent problème, facilitant la correction.</p><p>Le second test (<code class="language-plaintext highlighter-rouge">Controllers_DansNamespaceControllers</code>) illustre une vérification de convention de nommage et de localisation. On sélectionne toutes les classes dont le nom se termine par <em>Controller</em> puis on impose qu’elles résident dans le namespace <code class="language-plaintext highlighter-rouge">MonProjet.Api.Controllers</code>. Là encore, si par mégarde un contrôleur était placé dans un autre namespace (ou mal nommé), le test le signalerait immédiatement. Ce genre de règle agit comme une documentation vivante sur l’organisation attendue des composants : si quelqu’un crée un nouveau contrôleur au mauvais endroit, le test le rappellera à l’ordre sans attendre la revue de code.</p><p>Ces tests d’architecture s’exécutent comme n’importe quels tests unitaires via votre <em>runner</em> habituel (ou en CI). Lorsqu’une règle échoue, ArchUnitNET fournit un message d’erreur explicite listant les éléments fautifs et la raison fournie. L’équipe dispose donc d’un <em>feedback</em> clair et actionnable pour corriger l’architecture avant même que le code n’atterrisse en production.</p><h2 id="checklist--ce-que-je-valide-via-les-tests-darchitecture"><span class="mr-2">Checklist : Ce que je valide via les tests d’architecture</span><a href="#checklist--ce-que-je-valide-via-les-tests-darchitecture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Pour récapituler, voici une <strong>checklist</strong> de quelques règles que j’automatise dans les projets .NET à l’aide de tests d’architecture :</p><ul><li><strong>Séparation stricte des couches</strong> – Aucune dépendance illégitime entre couches n’est tolérée. Par exemple, la couche <em>Domaine</em> n’importe pas de classe de l’Infrastructure, l’UI n’accède pas directement à la DAL sans passer par la couche Application, etc. Chaque niveau ne connaît que les contrats (interfaces) définis aux niveaux inférieurs, jamais les implémentations concrètes des niveaux supérieurs.<li><strong>Conventions de nommage et de localisation</strong> – Les classes de contrôleur ASP.NET MVC/Web API doivent être suffixées par <em>Controller</em> et résider dans le namespace dédié (exemple : <code class="language-plaintext highlighter-rouge">MonProjet.Api.Controllers</code>). De même, on peut imposer que les classes de service se terminent par <em>Service</em>, que les interfaces commencent par un <em>I</em>, etc., afin de garder une cohérence dans tout le code.<li><strong>Pas de dépendances transverses non désirées</strong> – On vérifie qu’aucun composant ne “court-circuite” l’architecture en appelant du code qu’il ne devrait pas. Par exemple, un service de l’UI ne va pas directement appeler une classe de <em>Domaine</em> sans passer par Application, un contrôleur ne doit pas accéder directement à la base de données, etc. Ces règles encapsulent les <em>bonnes pratiques</em> de l’architecture pour éviter les couplages cachés.<li><strong>Isolation du cœur métier</strong> – Les couches externes (<em>Interface Adapters</em>, comme les contrôleurs/web, ou la couche Infrastructure) ne doivent pas référencer directement les entités du domaine. On préfère qu’elles passent par des <em>DTOs</em> ou des interfaces. Cela évite de fuiter la logique interne du domaine vers l’extérieur et renforce le principe d’inversion des dépendances (le domaine expose des abstractions que les autres implémentent, sans quoi c’est le domaine qui se mettrait à dépendre de détails externes).<li><strong>Autres conventions spécifiques</strong> – Tout ce qui relève de règles d’architecture propres à votre projet peut faire l’objet d’un test. Par exemple, vérifier que <em>les repositories implémentent bien les interfaces du domaine</em>, que <em>les classes dans tel namespace sont</em> sealed <em>ou encore qu’aucun service applicatif n’est statique</em>. L’important est de capturer ces invariants architecturaux sous forme de tests pour s’assurer qu’ils seront vrais en permanence.</ul><p>Bien sûr, la checklist ci-dessus dépend du contexte de chaque projet. À vous d’identifier les points névralgiques de votre architecture et de les couvrir par des tests adéquats. L’avantage est qu’une fois en place, ce filet de sécurité tourne en continu et vous alerte au moindre écart.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Après plusieurs mois d’utilisation, je peux confirmer que les tests d’architecture automatisés apportent une réelle valeur à long terme. Au début, cela demande un petit investissement (formaliser les règles, écrire les tests), mais cet effort est largement rentabilisé par la suite. Notre code reste plus <strong>propre</strong> et <strong>cohérente</strong> : fini les dépendances hasardeuses introduites par inadvertance, car le pipeline de build les attrape immédiatement. Cela facilite aussi les <strong>refactorings</strong> de grande ampleur, on peut restructurer le code en confiance, en sachant que si une règle d’architecture est brisée, un test rouge nous le signalera aussitôt.</p><p>Mon retour d’expérience est que ces tests jouent un rôle de <strong>garde-fou invisible</strong> mais nécessaires. Ils soulèvent les problèmes d’architecture très en amont (dès la PR ou même avant, en local) et évitent des revues de code interminables sur la structure du projet. L’équipe gagne en sérénité et peut se concentrer sur le métier, sachant que le respect des principes d’architecture est surveillé automatiquement.</p><p>Pour les équipes .NET déjà bien rodées qui souhaitent franchir un cap supplémentaire en qualité, je conseille d’expérimenter les tests d’architecture. Commencez petit à petit, avec quelques règles simples sur les dépendances entre couches par exemple, puis élargissez la portée progressivement. Impliquez l’équipe dans la définition de ces règles, cela peut même servir de base à des discussions saines sur l’architecture souhaitée. Intégrez enfin ces tests au pipeline CI/CD afin qu’ils tournent à chaque commit et empêchent toute régression architecturale.</p><p>En conclusion, les tests d’architecture automatisés sont un outil de plus dans l’arsenal des équipes .NET matures pour <strong>assurer la pérennité du design logiciel</strong>. Ils apportent une forme de qualité logicielle souvent négligée, en faisant vivre les principes d’architecture au même titre que le code métier. Si votre projet commence à prendre de l’ampleur, n’hésitez pas à les adopter : votre architecture (et vos coéquipiers) vous remercieront sur le long terme !</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/outil-developpement/'>outil-developpement</a>, <a href='/categories/architecture/'>architecture</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dotnet/" class="post-tag no-text-decoration" >dotnet</a> <a href="/tags/essais/" class="post-tag no-text-decoration" >essais</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Cet article est sous licence <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> par l'auteur.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Partager</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Essais%20automatis%C3%A9s%20d%E2%80%99architecture%20dans%20un%20projet%20.NET%20-%20CodeWithFrenchy&url=https%3A%2F%2Fcodewithfrenchy.github.io%2F%2Fposts%2Fessais-architecture-automatises-dotnet%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcodewithfrenchy.github.io%2F%2Fposts%2Fessais-architecture-automatises-dotnet%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Essais%20automatis%C3%A9s%20d%E2%80%99architecture%20dans%20un%20projet%20.NET%20-%20CodeWithFrenchy&u=https%3A%2F%2Fcodewithfrenchy.github.io%2F%2Fposts%2Fessais-architecture-automatises-dotnet%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copier le lien" data-title-succeed="Lien copié avec succès!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Récemment mis à jour</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/plan-formation-dotnet/">Plan de formation - .NET Framework vers .NET moderne</a><li><a href="/posts/essais-architecture-automatises-dotnet/">Essais automatisés d’architecture dans un projet .NET</a><li><a href="/posts/performances-jsonserializeroptions-singleton/">Amélioration des performances en utilisant JsonSerializerOptions en singleton</a><li><a href="/posts/source-generator-dotnet/">Les Générateurs de source</a><li><a href="/posts/guid-versus-id/">GUID vs ID auto-incrémenté - dilemme et solutions en environnement .NET distribué</a></ul></div><div id="access-tags"><div class="panel-heading">Tags tendance</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/essais/">essais</a> <a class="post-tag" href="/tags/conference/">conference</a> <a class="post-tag" href="/tags/source-generator/">source-generator</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet-core</a> <a class="post-tag" href="/tags/fluentassertions/">fluentassertions</a> <a class="post-tag" href="/tags/fluentvalidation/">fluentvalidation</a> <a class="post-tag" href="/tags/k6/">k6</a> <a class="post-tag" href="/tags/mapperly/">mapperly</a> <a class="post-tag" href="/tags/testcontainers/">testcontainers</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenu</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Autres lectures</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mise-a-jour-mstest/"><div class="card-body"> <em class="small" data-ts="1719442800" data-df="DD/MM/YYYY" > 26/06/2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Découvrez la nouvelle version de MSTest</h3><div class="text-muted small"><p> Microsoft vient tout juste de sortir une nouvelle version de MSTest! Quoi de neuf ? MSTest.Analyzers : Plein de corrections de bugs et d’améliorations pour rendre vos analyses de code encore p...</p></div></div></a></div><div class="card"> <a href="/posts/dotnet10/"><div class="card-body"> <em class="small" data-ts="1759791600" data-df="DD/MM/YYYY" > 06/10/2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>.NET 10 - Nouveautés, Performances et Support Prolongé</h3><div class="text-muted small"><p> En novembre 2025, Microsoft lancera .NET 10, probablement lors de .NET Conf (du 11 au 13 novembre). Cette version s’annonce riche en améliorations de performance et nouvelles fonctionnalités, tout ...</p></div></div></a></div><div class="card"> <a href="/posts/source-generator-dotnet/"><div class="card-body"> <em class="small" data-ts="1727647200" data-df="DD/MM/YYYY" > 29/09/2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Les Générateurs de source</h3><div class="text-muted small"><p> Les Source Generators (Générateurs de source) sont des outils intégrés au compilateur qui génèrent automatiquement du code source lors de la compilation, permettant aux développeurs d’automatiser l...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/concevoir-maintenir-application-performante-dotnet/" class="btn btn-outline-primary" prompt="Plus ancien"><p>Concevoir et maintenir des applications microservices performantes en .NET</p></a> <a href="/posts/pourquoi-livrer-souvent/" class="btn btn-outline-primary" prompt="Plus récent"><p>Fréquenter les mises en production - pourquoi livrer souvent change la donne</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Tags tendance</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/essais/">essais</a> <a class="post-tag" href="/tags/conference/">conference</a> <a class="post-tag" href="/tags/source-generator/">source-generator</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet-core</a> <a class="post-tag" href="/tags/fluentassertions/">fluentassertions</a> <a class="post-tag" href="/tags/fluentvalidation/">fluentvalidation</a> <a class="post-tag" href="/tags/k6/">k6</a> <a class="post-tag" href="/tags/mapperly/">mapperly</a> <a class="post-tag" href="/tags/testcontainers/">testcontainers</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/alexis35115">Alexis Garon-Michaud</a>. <span data-toggle="tooltip" data-placement="top" title="Sauf mention contraire, les articles de ce site sont publiés sous licence sous la licence Creative Commons Attribution 4.0 International (CC BY 4.0) par l'auteur.">Certains droits réservés.</span></p></div><div class="footer-right"><p class="mb-0">Propulsé par <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> avec le thème <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oups! Aucun résultat trouvé.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/fr.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
